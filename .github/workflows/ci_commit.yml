# Per-commit CI: Fast feedback on every push to non-main branches
# Duration target: < 1 minute
# Runs: lint, format-check, and unit tests (excluding slow tests)

name: Per-Commit CI

on:
  push:
    branches-ignore:
      - main

jobs:
  ci-commit:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -l {0}

    steps:
    - uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v6
      with:
        version: "latest"

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: uv sync --group dev

    - name: Run per-commit CI checks
      run: make ci-commit
